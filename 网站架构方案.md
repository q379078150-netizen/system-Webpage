# 网站架构设计方案

## 一、项目概述

### 1.1 项目目标
构建一个加密货币代币数据监控网站，实时显示多个代币的关键指标：
- Holders（持有者数量）
- Market Cap（市值）
- Volume（交易量）
- Price USD（美元价格）
- 1H Change（1小时涨跌幅）
- 24H Change（24小时涨跌幅）

### 1.2 技术栈选择

#### 后端技术栈
- **框架**: Flask (Python)
- **数据抓取**: requests + BeautifulSoup4
- **数据库**: SQLite（轻量级，适合单机部署）或 PostgreSQL（生产环境）
- **任务调度**: APScheduler（定时抓取数据）
- **API**: RESTful API

#### 前端技术栈
- **基础**: HTML5 + CSS3 + JavaScript (ES6+)
- **UI框架**: Bootstrap 5 或 Tailwind CSS
- **图表库**: Chart.js（用于数据可视化）
- **实时更新**: Fetch API + setInterval 或 WebSocket

#### 部署方案
- **开发环境**: Flask开发服务器
- **生产环境**: Gunicorn + Nginx（推荐）或 Docker容器化部署

---

## 二、系统架构设计

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────┐
│              用户浏览器 (Frontend)                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│  │   HTML   │  │   CSS    │  │    JS    │      │
│  └──────────┘  └──────────┘  └──────────┘      │
└───────────────────┬─────────────────────────────┘
                    │ HTTP/HTTPS
                    │ RESTful API
┌───────────────────▼─────────────────────────────┐
│            Flask Web Server (Backend)           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│  │  Routes  │  │  API     │  │  Views   │      │
│  └──────────┘  └──────────┘  └──────────┘      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│  │ Scraper  │  │ Database │  │ Scheduler│      │
│  └──────────┘  └──────────┘  └──────────┘      │
└───────────────────┬─────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────┐
│           外部数据源 (odin.fun)                  │
└─────────────────────────────────────────────────┘
```

### 2.2 模块划分

#### 后端模块
1. **路由模块 (routes.py)**: 处理HTTP请求
2. **数据抓取模块 (scraper.py)**: 从目标网站抓取数据
3. **数据处理模块 (data_processor.py)**: 数据清洗和格式化
4. **数据库模块 (models.py)**: 数据模型和数据库操作
5. **API模块 (api.py)**: RESTful API接口
6. **任务调度模块 (scheduler.py)**: 定时任务管理

#### 前端模块
1. **页面结构 (index.html)**: 主页面布局
2. **样式文件 (styles.css)**: 页面样式
3. **交互逻辑 (app.js)**: 前端JavaScript逻辑
4. **数据可视化 (charts.js)**: 图表展示

---

## 三、项目目录结构

```
crypto_monitor/
├── app.py                 # Flask应用入口
├── config.py              # 配置文件
├── requirements.txt       # Python依赖
├── README.md             # 项目说明
│
├── backend/               # 后端代码
│   ├── __init__.py
│   ├── routes.py         # 路由定义
│   ├── api.py            # API接口
│   ├── scraper.py        # 数据抓取
│   ├── data_processor.py # 数据处理
│   ├── models.py         # 数据模型
│   └── scheduler.py      # 任务调度
│
├── frontend/              # 前端代码
│   ├── static/           # 静态资源
│   │   ├── css/
│   │   │   └── style.css
│   │   ├── js/
│   │   │   ├── app.js
│   │   │   └── charts.js
│   │   └── images/
│   └── templates/        # HTML模板
│       └── index.html
│
├── database/             # 数据库文件
│   └── crypto_data.db    # SQLite数据库
│
├── logs/                 # 日志文件
│   └── app.log
│
└── tests/                # 测试文件
    ├── test_scraper.py
    └── test_api.py
```

---

## 四、核心功能设计

### 4.1 数据抓取功能
- **目标URL**: https://odin.fun/token/{token_id}
- **抓取频率**: 每5分钟更新一次
- **数据字段**: Holders, Market Cap, Volume, Price USD, 1H, 24H
- **错误处理**: 重试机制、异常日志记录

### 4.2 API接口设计

```
GET /api/tokens              # 获取所有代币列表
GET /api/token/<token_id>   # 获取单个代币数据
GET /api/token/<token_id>/history  # 获取历史数据
POST /api/token/add          # 添加新代币监控
DELETE /api/token/<token_id> # 删除代币监控
```

### 4.3 前端功能
- **实时数据展示**: 表格形式展示所有代币数据
- **数据刷新**: 自动刷新（每30秒）或手动刷新
- **数据可视化**: 价格趋势图表
- **响应式设计**: 支持移动端访问
- **数据排序**: 按各字段排序
- **数据筛选**: 按涨跌幅筛选

---

## 五、数据库设计

### 5.1 数据表结构

#### tokens表（代币信息）
```sql
CREATE TABLE tokens (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    token_id TEXT UNIQUE NOT NULL,
    name TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### token_data表（代币数据）
```sql
CREATE TABLE token_data (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    token_id TEXT NOT NULL,
    holders TEXT,
    market_cap TEXT,
    volume TEXT,
    price_usd TEXT,
    change_1h TEXT,
    change_24h TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (token_id) REFERENCES tokens(token_id)
);
```

---

## 六、开发步骤

### 阶段一：基础架构搭建
1. 创建项目目录结构
2. 配置Flask应用
3. 创建基础路由和模板
4. 实现简单的数据展示

### 阶段二：数据抓取功能
1. 实现数据抓取模块
2. 添加数据解析逻辑
3. 实现错误处理和重试机制
4. 添加日志记录

### 阶段三：数据库集成
1. 设计数据库模型
2. 实现数据存储功能
3. 实现数据查询接口
4. 添加历史数据功能

### 阶段四：API开发
1. 实现RESTful API
2. 添加API文档
3. 实现数据验证
4. 添加错误处理

### 阶段五：前端优化
1. 优化UI设计
2. 实现实时数据更新
3. 添加数据可视化
4. 实现响应式设计

### 阶段六：任务调度
1. 实现定时抓取任务
2. 添加任务管理功能
3. 实现任务监控

### 阶段七：测试和部署
1. 编写单元测试
2. 进行集成测试
3. 性能优化
4. 部署到生产环境

---

## 七、安全考虑

1. **输入验证**: 验证所有用户输入
2. **SQL注入防护**: 使用参数化查询
3. **XSS防护**: 转义用户输入
4. **CORS配置**: 配置跨域资源共享
5. **速率限制**: 防止API滥用
6. **错误处理**: 不暴露敏感信息

---

## 八、性能优化

1. **缓存机制**: 使用Redis缓存热点数据
2. **数据库索引**: 为常用查询字段添加索引
3. **异步处理**: 使用异步任务处理耗时操作
4. **CDN加速**: 静态资源使用CDN
5. **数据库连接池**: 优化数据库连接管理

---

## 九、监控和日志

1. **应用日志**: 记录关键操作和错误
2. **性能监控**: 监控API响应时间
3. **错误追踪**: 记录和追踪错误
4. **数据统计**: 统计访问量和数据更新频率

---

## 十、扩展性考虑

1. **微服务架构**: 未来可拆分为多个微服务
2. **消息队列**: 使用消息队列处理异步任务
3. **分布式部署**: 支持多服务器部署
4. **API版本管理**: 支持API版本控制

---

## 下一步行动

1. 确认技术栈选择
2. 创建项目目录结构
3. 搭建基础框架
4. 实现核心功能
5. 测试和优化
